<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HMS ‚Äî Register</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--navy:#0a1628;--navy2:#112240;--teal:#00b4d8;--teal2:#0096c7;--white:#f0f4f8;--gray:#8892a4}
body{min-height:100vh;background:var(--navy);font-family:'DM Sans',sans-serif;display:flex;align-items:center;justify-content:center;padding:20px}
.box{width:100%;max-width:480px;background:var(--navy2);border:1px solid rgba(255,255,255,.08);border-radius:20px;padding:32px 28px}
.logo{text-align:center;margin-bottom:24px}
.logo-icon{font-size:36px;margin-bottom:10px}
.logo h1{font-family:'Playfair Display',serif;font-size:1.5rem;color:var(--white)}
.logo p{color:var(--gray);font-size:.84rem;margin-top:4px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.fg{margin-bottom:14px}
.fg label{display:block;color:var(--gray);font-size:.74rem;font-weight:600;text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px}
.fg input,.fg select{width:100%;padding:12px 13px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:8px;color:var(--white);font-size:.9rem;font-family:'DM Sans',sans-serif;outline:none;transition:all .2s}
.fg select option{background:var(--navy2)}
.fg input::placeholder{color:rgba(136,146,164,.4)}
.fg input:focus,.fg select:focus{border-color:var(--teal);box-shadow:0 0 0 3px rgba(0,180,216,.1)}
.role-info{background:rgba(0,180,216,.06);border:1px solid rgba(0,180,216,.15);border-radius:8px;padding:10px 13px;font-size:.8rem;color:var(--gray);margin-bottom:14px}
.btn{width:100%;padding:13px;background:linear-gradient(135deg,var(--teal),var(--teal2));border:none;border-radius:10px;color:#fff;font-size:.95rem;font-weight:600;font-family:'DM Sans',sans-serif;cursor:pointer;transition:all .3s;margin-top:4px}
.btn:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,180,216,.3)}
.btn:disabled{opacity:.6;cursor:not-allowed;transform:none}
.err{background:rgba(230,57,70,.1);border:1px solid rgba(230,57,70,.3);color:#ff6b6b;padding:11px 13px;border-radius:8px;font-size:.83rem;margin-bottom:14px;display:none}
.suc{background:rgba(46,204,113,.1);border:1px solid rgba(46,204,113,.3);color:#2ecc71;padding:11px 13px;border-radius:8px;font-size:.83rem;margin-bottom:14px;display:none}
.bottom-link{text-align:center;margin-top:18px;color:var(--gray);font-size:.875rem}
.bottom-link a{color:var(--teal);text-decoration:none;font-weight:500}
.spin{width:15px;height:15px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .8s linear infinite;display:inline-block;margin-right:6px;vertical-align:middle}
@keyframes spin{to{transform:rotate(360deg)}}
@media(max-width:480px){.row{grid-template-columns:1fr}.box{padding:24px 18px}}
</style>
</head>
<body>
<div class="box">
  <div class="logo">
    <div class="logo-icon">üè•</div>
    <h1>Create Account</h1>
    <p>Join the Hospital Management System</p>
  </div>

  <div class="err" id="errMsg"></div>
  <div class="suc" id="sucMsg"></div>

  <div class="row">
    <div class="fg"><label>First Name</label><input type="text" id="firstName" placeholder="John"></div>
    <div class="fg"><label>Last Name</label><input type="text" id="lastName" placeholder="Doe"></div>
  </div>
  <div class="fg"><label>Username</label><input type="text" id="username" placeholder="johndoe"></div>
  <div class="fg"><label>Email</label><input type="email" id="email" placeholder="john@example.com"></div>
  <div class="fg"><label>Phone</label><input type="text" id="phone" placeholder="9999999999"></div>
  <div class="fg"><label>Register As</label>
    <select id="role" onchange="updateInfo()">
      <option value="doctor">Doctor</option>
      <option value="patient">Patient</option>
    </select>
  </div>
  <div class="role-info" id="roleInfo">Registering as a <strong style="color:var(--teal)">Doctor</strong> ‚Äî manage appointments and write prescriptions.</div>
  <div class="row">
    <div class="fg"><label>Password</label><input type="password" id="password" placeholder="Min 8 chars"></div>
    <div class="fg"><label>Confirm</label><input type="password" id="password2" placeholder="Repeat"></div>
  </div>

  <button class="btn" id="regBtn" onclick="register()"><span id="btnText">Create Account</span></button>
  <div class="bottom-link">Already have an account? <a href="login.html">Sign In</a></div>
</div>

<script>
const API='https://hospital-management-system-y46v.onrender.com';
function updateInfo(){
  const r=document.getElementById('role').value;
  document.getElementById('roleInfo').innerHTML=r==='doctor'
    ?'Registering as a <strong style="color:#00b4d8">Doctor</strong> ‚Äî manage appointments and write prescriptions.'
    :'Registering as a <strong style="color:#a8dadc">Patient</strong> ‚Äî book appointments and view your medical records.';
}
async function register(){
  const btn=document.getElementById('regBtn');
  const err=document.getElementById('errMsg');
  const suc=document.getElementById('sucMsg');
  err.style.display='none';suc.style.display='none';
  const role=document.getElementById('role').value;
  if(role==='admin'){err.textContent='Admin accounts cannot be registered here.';err.style.display='block';return}
  const data={
    first_name:document.getElementById('firstName').value.trim(),
    last_name:document.getElementById('lastName').value.trim(),
    username:document.getElementById('username').value.trim(),
    email:document.getElementById('email').value.trim(),
    phone:document.getElementById('phone').value.trim(),
    role,
    password:document.getElementById('password').value,
    password2:document.getElementById('password2').value,
  };
  if(!data.username||!data.email||!data.first_name||!data.password){err.textContent='Please fill in all required fields.';err.style.display='block';return}
  if(data.password!==data.password2){err.textContent='Passwords do not match.';err.style.display='block';return}
  if(data.password.length<8){err.textContent='Password must be at least 8 characters.';err.style.display='block';return}
  btn.disabled=true;
  document.getElementById('btnText').innerHTML='<span class="spin"></span>Creating account...';
  try{
    const r=await fetch(`${API}/api/auth/register/`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});
    const res=await r.json();
    if(r.ok){suc.textContent='Account created! Redirecting to login...';suc.style.display='block';setTimeout(()=>window.location.href='login.html',2000)}
    else{const e=Object.entries(res).map(([k,v])=>`${k}: ${Array.isArray(v)?v.join(', '):v}`).join(' | ');err.textContent=e||'Registration failed.';err.style.display='block'}
  }catch(e){err.textContent='Cannot connect to server.';err.style.display='block'}
  finally{btn.disabled=false;document.getElementById('btnText').textContent='Create Account'}
}
</script>
</body>
</html>
